<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Markdown Viewer Test</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div id="container">
        <div id="markdown-content"></div>
    </div>
    
    <script src="lib/marked.min.js"></script>
    <script src="lib/mermaid.min.js"></script>
    <script src="js/toc-generator.js"></script>
    <script src="js/theme-manager.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/toolbar.js"></script>
    
    <script>
        const testMarkdown = `# Enhanced Markdown Viewer Test ğŸš€

ã“ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯æ–°ã—ãå®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

## ğŸ¯ å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½

### 1. ç›®æ¬¡è‡ªå‹•ç”Ÿæˆ
- âœ… éšå±¤æ§‹é€ ã®è‡ªå‹•èªè­˜
- âœ… ã‚¯ãƒªãƒƒã‚¯ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¸ãƒ£ãƒ³ãƒ—
- âœ… ç¾åœ¨ä½ç½®ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- âœ… æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½

### 2. ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ 
- âœ… ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ
- âœ… ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ  
- âœ… ã‚»ãƒ”ã‚¢ãƒ†ãƒ¼ãƒ
- âœ… è‡ªå‹•ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ

### 3. æ¤œç´¢æ©Ÿèƒ½
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢
- âœ… æ­£è¦è¡¨ç¾ã‚µãƒãƒ¼ãƒˆ
- âœ… å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥
- âœ… çµæœãƒã‚¤ãƒ©ã‚¤ãƒˆ

## ğŸ“Š Mermaidãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ãƒ†ã‚¹ãƒˆ

### ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
\`\`\`mermaid
graph TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Process A]
    B -->|No| D[Process B]
    C --> E[End]
    D --> E
\`\`\`

### ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³
\`\`\`mermaid
sequenceDiagram
    participant User
    participant Extension
    participant Markdown
    participant Mermaid
    
    User->>Extension: Open .md file
    Extension->>Markdown: Parse content
    Markdown-->>Extension: HTML output
    Extension->>Mermaid: Render diagrams
    Mermaid-->>Extension: SVG output
    Extension->>User: Display result
\`\`\`

### ã‚¯ãƒ©ã‚¹å›³
\`\`\`mermaid
classDiagram
    class ThemeManager {
        +themes: Map
        +currentTheme: string
        +applyTheme()
        +registerTheme()
    }
    
    class TOCGenerator {
        +headings: Array
        +options: Object
        +extractHeadings()
        +renderTOC()
    }
    
    class SearchEngine {
        +searchIndex: Map
        +currentResults: Array
        +search()
        +navigateResults()
    }
    
    class Toolbar {
        +themeManager: ThemeManager
        +tocGenerator: TOCGenerator
        +searchEngine: SearchEngine
        +init()
    }
    
    Toolbar --> ThemeManager
    Toolbar --> TOCGenerator
    Toolbar --> SearchEngine
\`\`\`

## ğŸ“ ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ

### JavaScript
\`\`\`javascript
class MarkdownViewer {
    constructor(options) {
        this.options = options;
        this.init();
    }
    
    init() {
        console.log('Initializing enhanced viewer...');
        this.setupComponents();
    }
    
    setupComponents() {
        this.toolbar = new Toolbar();
        this.themeManager = new ThemeManager();
        this.tocGenerator = new TOCGenerator();
        this.searchEngine = new SearchEngine();
    }
}
\`\`\`

### Python
\`\`\`python
def test_markdown_features():
    """Test all implemented features"""
    features = [
        'toc_generation',
        'theme_switching', 
        'search_functionality',
        'mermaid_rendering'
    ]
    
    for feature in features:
        result = test_feature(feature)
        print(f"{feature}: {'âœ… PASS' if result else 'âŒ FAIL'}")
\`\`\`

### CSS
\`\`\`css
/* Enhanced theming system */
:root {
    --primary-color: #0969da;
    --bg-color: #ffffff;
    --text-color: #24292e;
}

[data-theme="dark"] {
    --bg-color: #0d1117;
    --text-color: #e6edf3;
}
\`\`\`

## ğŸ“‹ ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ†ã‚¹ãƒˆ

| æ©Ÿèƒ½ | çŠ¶æ…‹ | è©³ç´° | å‚™è€ƒ |
|------|------|------|------|
| TOC Generator | âœ… å®Œäº† | éšå±¤æ§‹é€ å¯¾å¿œ | ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« |
| Theme Manager | âœ… å®Œäº† | 3ãƒ†ãƒ¼ãƒ + è‡ªå‹• | CSSå¤‰æ•°ä½¿ç”¨ |
| Search Engine | âœ… å®Œäº† | æ­£è¦è¡¨ç¾å¯¾å¿œ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  |
| Toolbar | âœ… å®Œäº† | çµ±åˆUI | ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– |
| Print Support | âœ… å®Œäº† | CSSæœ€é©åŒ– | ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒª |

## ğŸ¨ ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ

### å¼•ç”¨æ–‡
> **é‡è¦ãªæ©Ÿèƒ½**  
> ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€å¾“æ¥ã®åŸºæœ¬çš„ãªMarkdownãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã‹ã‚‰ã€
> é–‹ç™ºè€…å‘ã‘ã®é«˜æ©Ÿèƒ½ãƒ„ãƒ¼ãƒ«ã¸ã¨é€²åŒ–ã—ã¾ã—ãŸã€‚

### ãƒªã‚¹ãƒˆ
1. **Phase 1å®Ÿè£…é …ç›®**
   - ç›®æ¬¡è‡ªå‹•ç”Ÿæˆ
   - ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ 
   - æ¤œç´¢æ©Ÿèƒ½
   - ãƒ„ãƒ¼ãƒ«ãƒãƒ¼çµ±åˆ

2. **ä»Šå¾Œã®æ‹¡å¼µäºˆå®š**
   - [ ] Markdownç·¨é›†æ©Ÿèƒ½
   - [ ] ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ©Ÿèƒ½
   - [ ] PDFå‡ºåŠ›
   - [ ] ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

### å¼·èª¿ã¨ãƒªãƒ³ã‚¯
- **å¤ªå­—ãƒ†ã‚­ã‚¹ãƒˆ**
- *æ–œä½“ãƒ†ã‚­ã‚¹ãƒˆ*
- \`ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰\`
- ~~å–ã‚Šæ¶ˆã—ç·š~~
- [ãƒªãƒ³ã‚¯ãƒ†ã‚¹ãƒˆ](https://github.com)

## ğŸ§ª ãƒ†ã‚¹ãƒˆé …ç›®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### åŸºæœ¬æ©Ÿèƒ½
- [x] Markdownãƒ‘ãƒ¼ã‚¹
- [x] Mermaidæç”»
- [x] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### æ‹¡å¼µæ©Ÿèƒ½  
- [x] TOCç”Ÿæˆãƒ»è¡¨ç¤º
- [x] ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ
- [x] æ¤œç´¢ãƒ‘ãƒãƒ«
- [x] ãƒ„ãƒ¼ãƒ«ãƒãƒ¼
- [x] è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
- [x] å°åˆ·æœ€é©åŒ–

### æ“ä½œæ€§
- [x] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
- [x] ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
- [x] æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½
- [x] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é€Ÿåº¦
- Markdownè§£æ: < 100ms
- Mermaidæç”»: < 500ms  
- TOCç”Ÿæˆ: < 50ms
- ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ: < 200ms

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- åŸºæœ¬è¡¨ç¤º: ~5MB
- å…¨æ©Ÿèƒ½æœ‰åŠ¹: ~15MB
- å¤§å‹æ–‡æ›¸: ~25MB

---

**ãƒ†ã‚¹ãƒˆå®Œäº†** âœ¨  
ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
`;

        // Initialize mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose'
        });

        // Custom renderer for markdown
        const renderer = new marked.Renderer();
        let mermaidCounter = 0;

        renderer.code = function(code, language) {
            if (language === 'mermaid') {
                const id = `mermaid-${mermaidCounter++}`;
                return `<div class="mermaid" id="${id}" data-mermaid-code="${encodeURIComponent(code)}">${code}</div>`;
            }
            const escapeHtml = (text) => {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            };
            return `<pre><code class="language-${language || ''}">${escapeHtml(code)}</code></pre>`;
        };

        marked.setOptions({
            renderer: renderer,
            gfm: true,
            breaks: false
        });

        // Render mermaid diagrams
        async function renderMermaidDiagrams() {
            const mermaidElements = document.querySelectorAll('.mermaid');
            console.log(`Found ${mermaidElements.length} mermaid elements`);
            
            for (const element of mermaidElements) {
                try {
                    const graphDefinition = element.textContent.trim();
                    const { svg } = await mermaid.render(`graph-${element.id}`, graphDefinition);
                    element.innerHTML = svg;
                    console.log('Mermaid rendered successfully');
                } catch (error) {
                    console.error('Mermaid error:', error);
                    element.innerHTML = `<pre style="color: red;">Mermaid error: ${error.message}</pre>`;
                }
            }
        }

        // Main initialization
        async function init() {
            try {
                console.log('Starting enhanced markdown test...');
                
                // Render markdown
                const html = marked.parse(testMarkdown);
                document.getElementById('markdown-content').innerHTML = html;
                
                // Render mermaid diagrams
                await renderMermaidDiagrams();
                
                // Store original content
                document.body.dataset.originalMarkdown = testMarkdown;
                
                // Initialize enhanced features
                setTimeout(() => {
                    try {
                        window.markdownViewerToolbar = new Toolbar();
                        console.log('âœ… All enhanced features initialized successfully');
                        
                        // Show success message
                        const successMsg = document.createElement('div');
                        successMsg.style.cssText = `
                            position: fixed;
                            top: 60px;
                            right: 20px;
                            background: #28a745;
                            color: white;
                            padding: 15px;
                            border-radius: 8px;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                            z-index: 9999;
                            font-weight: bold;
                        `;
                        successMsg.textContent = 'âœ¨ Enhanced features loaded successfully!';
                        document.body.appendChild(successMsg);
                        
                        setTimeout(() => successMsg.remove(), 3000);
                        
                    } catch (error) {
                        console.error('âŒ Error initializing enhanced features:', error);
                    }
                }, 500);
                
            } catch (error) {
                console.error('âŒ Test initialization error:', error);
                document.getElementById('markdown-content').innerHTML = 
                    `<h1>âŒ Test Error</h1><pre style="color: red;">${error.message}</pre>`;
            }
        }

        // Start test when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>