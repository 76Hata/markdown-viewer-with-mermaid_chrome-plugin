<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Markdown Viewer - Standalone</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div id="container">
        <div id="markdown-content"></div>
    </div>
    
    <!-- åŸºæœ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="lib/marked.min.js"></script>
    <script src="lib/mermaid.min.js"></script>
    
    <!-- æ‹¡å¼µæ©Ÿèƒ½ -->
    <script src="js/toc-generator.js"></script>
    <script src="js/theme-manager.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/toolbar.js"></script>
    
    <script>
        // ã‚µãƒ³ãƒ—ãƒ«Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„
        const sampleMarkdown = `# Enhanced Markdown Viewer Demo ğŸš€

ã“ã®ãƒ‡ãƒ¢ã§ã¯ã€å®Ÿè£…ã•ã‚ŒãŸå…¨ã¦ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

## ğŸ¯ å®Ÿè£…æ©Ÿèƒ½

### 1. ç›®æ¬¡è‡ªå‹•ç”Ÿæˆ
å·¦å´ã«è¡¨ç¤ºã•ã‚Œã‚‹ç›®æ¬¡ã‹ã‚‰å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¸ãƒ£ãƒ³ãƒ—ã§ãã¾ã™ã€‚

### 2. ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ 
ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ†ãƒ¼ãƒãƒœã‚¿ãƒ³ã‹ã‚‰ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒã‚’é¸æŠã§ãã¾ã™ï¼š
- **Light**: æ˜ã‚‹ã„ãƒ†ãƒ¼ãƒ
- **Dark**: æš—ã„ãƒ†ãƒ¼ãƒ  
- **Sepia**: ã‚»ãƒ”ã‚¢èª¿ãƒ†ãƒ¼ãƒ
- **Auto**: ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«é€£å‹•

### 3. æ¤œç´¢æ©Ÿèƒ½
\`Ctrl+F\` ã¾ãŸã¯æ¤œç´¢ãƒœã‚¿ãƒ³ã§é«˜æ©Ÿèƒ½æ¤œç´¢ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢
- æ­£è¦è¡¨ç¾ã‚µãƒãƒ¼ãƒˆ
- ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º

## ğŸ“Š Mermaidãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ãƒ†ã‚¹ãƒˆ

### ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
\`\`\`mermaid
graph TD
    A[ãƒ¦ãƒ¼ã‚¶ãƒ¼] --> B{æ©Ÿèƒ½é¸æŠ}
    B -->|ç›®æ¬¡| C[TOCè¡¨ç¤º]
    B -->|æ¤œç´¢| D[æ¤œç´¢ãƒ‘ãƒãƒ«]
    B -->|ãƒ†ãƒ¼ãƒ| E[ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ]
    C --> F[ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«]
    D --> G[ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º]
    E --> H[CSSå¤‰æ•°æ›´æ–°]
\`\`\`

### ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³
\`\`\`mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant T as ãƒ„ãƒ¼ãƒ«ãƒãƒ¼
    participant TM as ãƒ†ãƒ¼ãƒãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
    participant TOC as ç›®æ¬¡ç”Ÿæˆå™¨
    
    U->>T: ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    T->>TM: ãƒ†ãƒ¼ãƒå¤‰æ›´è¦æ±‚
    TM->>TM: CSSå¤‰æ•°æ›´æ–°
    TM->>TOC: å†æç”»é€šçŸ¥
    TOC->>U: UIæ›´æ–°å®Œäº†
\`\`\`

## ğŸ“ ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯

### JavaScript
\`\`\`javascript
// ãƒ„ãƒ¼ãƒ«ãƒãƒ¼åˆæœŸåŒ–ä¾‹
const toolbar = new Toolbar(document.body);
console.log('Enhanced features loaded!');
\`\`\`

### CSS
\`\`\`css
/* ãƒ†ãƒ¼ãƒå¤‰æ•°ä¾‹ */
:root {
    --bg-color: #ffffff;
    --text-color: #24292e;
}

[data-theme="dark"] {
    --bg-color: #0d1117;
    --text-color: #e6edf3;
}
\`\`\`

## ğŸ“‹ æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ç›®æ¬¡ãŒç”Ÿæˆã•ã‚Œã€ã‚¯ãƒªãƒƒã‚¯ã§ã‚¸ãƒ£ãƒ³ãƒ—ã§ãã‚‹
- [ ] ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆãŒå‹•ä½œã™ã‚‹
- [ ] æ¤œç´¢æ©Ÿèƒ½ãŒä½¿ãˆã‚‹
- [ ] Mermaidå›³ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãŒå‹•ä½œã™ã‚‹

## ğŸ® æ“ä½œæ–¹æ³•

### ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
- \`Ctrl+F\`: æ¤œç´¢ãƒ‘ãƒãƒ«è¡¨ç¤º
- \`Ctrl+T\`: ç›®æ¬¡è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
- \`Ctrl+P\`: å°åˆ·
- \`Escape\`: ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹

### ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãƒœã‚¿ãƒ³
- **ğŸ“‹**: ç›®æ¬¡è¡¨ç¤º/éè¡¨ç¤º
- **ğŸ”**: æ¤œç´¢ãƒ‘ãƒãƒ«è¡¨ç¤º
- **ğŸ¨**: ãƒ†ãƒ¼ãƒé¸æŠ
- **ğŸ–¨ï¸**: å°åˆ·
- **âš™ï¸**: è¨­å®š

---

**ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚Œã°ã€Enhanced Markdown Viewer ã¯å®Œç’§ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ï¼** âœ¨
`;

        // åˆæœŸåŒ–å‡¦ç†
        async function initializeStandaloneViewer() {
            try {
                console.log('Standalone viewer initialization started...');
                
                // MermaidåˆæœŸåŒ–
                if (typeof mermaid !== 'undefined') {
                    mermaid.initialize({
                        startOnLoad: false,
                        theme: 'default',
                        securityLevel: 'loose'
                    });
                }
                
                // Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                if (typeof marked !== 'undefined') {
                    const renderer = new marked.Renderer();
                    let mermaidCounter = 0;
                    
                    renderer.code = function(code, language) {
                        if (language === 'mermaid') {
                            const id = `mermaid-${mermaidCounter++}`;
                            return `<div class="mermaid" id="${id}" data-mermaid-code="${encodeURIComponent(code)}">${code}</div>`;
                        }
                        const escapeHtml = (text) => {
                            const div = document.createElement('div');
                            div.textContent = text;
                            return div.innerHTML;
                        };
                        return `<pre><code class="language-${language || ''}">${escapeHtml(code)}</code></pre>`;
                    };
                    
                    marked.setOptions({
                        renderer: renderer,
                        gfm: true,
                        breaks: false
                    });
                    
                    // HTMLã«å¤‰æ›
                    const html = marked.parse(sampleMarkdown);
                    document.getElementById('markdown-content').innerHTML = html;
                    
                    // Mermaidå›³ã‚’æç”»
                    await renderMermaidDiagrams();
                    
                    // å…ƒã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¿å­˜
                    document.body.dataset.originalMarkdown = sampleMarkdown;
                    
                    // ãƒ„ãƒ¼ãƒ«ãƒãƒ¼åˆæœŸåŒ–
                    setTimeout(() => {
                        if (typeof Toolbar !== 'undefined') {
                            window.markdownViewerToolbar = new Toolbar(document.body);
                            console.log('âœ… Standalone viewer initialized successfully!');
                            
                            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
                            showSuccessMessage();
                        } else {
                            console.error('âŒ Toolbar class not available');
                        }
                    }, 500);
                    
                } else {
                    console.error('âŒ Marked.js not available');
                }
                
            } catch (error) {
                console.error('âŒ Initialization error:', error);
            }
        }
        
        // Mermaidå›³ã®æç”»
        async function renderMermaidDiagrams() {
            if (typeof mermaid === 'undefined') return;
            
            const mermaidElements = document.querySelectorAll('.mermaid');
            console.log(`Found ${mermaidElements.length} mermaid elements`);
            
            for (let i = 0; i < mermaidElements.length; i++) {
                const element = mermaidElements[i];
                try {
                    const graphDefinition = element.textContent.trim();
                    const { svg } = await mermaid.render(`graph-${i}`, graphDefinition);
                    element.innerHTML = svg;
                    console.log(`âœ… Mermaid diagram ${i + 1} rendered`);
                } catch (error) {
                    console.error(`âŒ Mermaid diagram ${i + 1} error:`, error);
                    element.innerHTML = `<pre style="color: red;">Mermaid error: ${error.message}</pre>`;
                }
            }
        }
        
        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showSuccessMessage() {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 70px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 9999;
                font-weight: bold;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            `;
            message.innerHTML = `
                âœ¨ Enhanced Markdown Viewer å®Œå…¨å‹•ä½œä¸­ï¼<br>
                <small>å…¨ã¦ã®æ©Ÿèƒ½ã‚’ãŠè©¦ã—ãã ã•ã„</small>
            `;
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.opacity = '0';
                message.style.transition = 'opacity 0.5s';
                setTimeout(() => message.remove(), 500);
            }, 4000);
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeStandaloneViewer);
        } else {
            initializeStandaloneViewer();
        }
    </script>
</body>
</html>